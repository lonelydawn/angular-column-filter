app.directive("columnFilter",function(){return{restrict:"AE",template:'<table class="table table-bordered"><thead><tr><th class="relative cursor-pointer"  ng-repeat="item in tableData.field" ng-click="showModal($index);" ng-mouseleave="hideModal($index);"><span class="thead-label" ng-bind="item"></span><span class="flg-icon-character select-flg" ng-show="tableData.filter[$index]!=undefined">&nbsp;^</span><ul class="select-ul bg-white"><li ng-repeat="item in tableData.filter[$index]" ng-click="toggleItem($index, item);"><span class="space-flg">&nbsp;&nbsp;&nbsp;</span>{{item}}</li></ul></th></tr></thead><tbody><tr ng-repeat="row in showData"><td ng-repeat="item in row" ng-bind="item"></td></tr></tbody></table>',replace:!0,controller:function(e){e.tableData=[],e.showData=[],e.flgArr=[],e.fieldIndex=0,this.getTableData=function(a){e.tableData=a;for(var t=0;t<a.data.length;t++)e.showData.push(a.data[t]);for(var n=0;n<a.field.length;n++)e.flgArr.push(-1)}},link:function(e,a){e.showModal=function(t){e.fieldIndex=t,a.find(".select-ul")[t].style.display="block",a.find(".flg-icon-character")[t].innerHTML="&nbsp;v"},e.hideModal=function(e){a.find(".select-ul")[e].style.display="none",a.find(".flg-icon-character")[e].innerHTML="&nbsp;^"},e.toggleItem=function(t,n){e.flgArr[e.fieldIndex]=t;for(var l=$(a.find(".select-ul")[e.fieldIndex]).find(".space-flg"),i=0;i<l.length;i++)l[i].innerHTML="&nbsp;&nbsp;&nbsp;";l[t].innerHTML="&nbsp;&radic;&nbsp;",a.find(".thead-label")[e.fieldIndex].innerHTML=e.tableData.field[e.fieldIndex]+"("+n+")";for(var r=[],d=0;d<e.tableData.data.length;d++)r.push(e.tableData.data[d]);var s=function(a){if(a<e.flgArr.length){if(e.flgArr[a]>-1){var t=e.tableData.filter[a][e.flgArr[a]];if("全部"!=t){for(var n=[],l=0;l<r.length;l++)t==r[l][a]&&n.push(r[l]);r=n}}s(++a)}};s(0),e.showData=r}}}}),app.directive("ngTableData",function(){return{require:"^columnFilter",link:function(e,a,t,n){n.getTableData(e[t.ngTableData])}}});